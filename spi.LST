C51 COMPILER V6.02  SPI                                                                    11/30/2015 00:31:38 PAGE 1   


C51 COMPILER V6.02, COMPILATION OF MODULE SPI
OBJECT MODULE PLACED IN .\spi.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE .\spi.c DEBUG OBJECTEXTEND

stmt level    source

   1          #include "spi.h"
   2          #include <stdio.h>
   3          /***********************************************************************
   4          DESC:  Initialization of SPI
   5          INPUT: 	None
   6          RETURNS: None
   7          CAUTION: 
   8          ************************************************************************/
   9          uint8_t SPI_Master_Init(uint32_t clock_rate)
  10          {
  11   1      	if(	clock_rate == 400000)
  12   1      	{
  13   2      		SPCON=0xF1;  // Clock Rate 400kHz
  14   2      	}
  15   1      	else if(clock_rate == OSC_FREQ/2)
  16   1      	{
  17   2      		SPCON=0x70;	// Clock rate Oscillation freq/2
  18   2      	}  
  19   1      	return 0;
  20   1      
  21   1      }
  22          /***********************************************************************
  23          DESC: SPI Transfer
  24          INPUT: send value, received value
  25          RETURNS: timeout
  26          CAUTION: None
  27          ************************************************************************/
  28          uint8_t SPI_Transfer(uint8_t send_value, uint8_t *received_value)
  29          {
  30   1      	uint8_t test,timeout;
  31   1      	timeout=0;
  32   1      	SPDAT=send_value;
  33   1      	do
  34   1      	{
  35   2      		test=SPSTA;
  36   2      		timeout++;
  37   2      	}				   
  38   1      	while(!(test&0xF0) && (timeout!=0));
  39   1      
  40   1      	if( timeout!=0 )
  41   1      	{
  42   2      		*received_value = SPDAT;
  43   2      		timeout=test & 0x70;
  44   2      	}
  45   1      	else
  46   1      	{
  47   2      	 	timeout=TIMEOUT_ERROR;
  48   2      		printf("\n SPI ERROR in SPI transfer \n");
  49   2      	}
  50   1      	return timeout;
  51   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    112    ----
C51 COMPILER V6.02  SPI                                                                    11/30/2015 00:31:38 PAGE 2   

   CONSTANT SIZE    =     30    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
